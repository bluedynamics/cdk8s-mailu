<!DOCTYPE html>
<html lang="en" data-accent-color="cyan" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Setup Prerequisites - cdk8s-mailu</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Setup PostgreSQL Database" href="setup-postgresql.html" /><link rel="prev" title="How-To Guides" href="index.html" />
      <link rel="canonical" href="https://bluedynamics.github.io/cdk8s-mailu/how-to/setup-prerequisites.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"dark");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=14737038" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/brand-theme.css?v=e545c45d" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://bluedynamics.github.io/cdk8s-mailu/how-to/setup-prerequisites.html"/>
  <meta property="og:title" content="Setup Prerequisites"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="/">
      <img class="light-logo" src="../_static/mailu-logo.svg" alt="cdk8s-mailu" height="28" loading="lazy" />
      <img class="dark-logo" src="../_static/mailu-logo.svg" alt="cdk8s-mailu" height="28" loading="lazy" />
      <strong>cdk8s-mailu</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/01-quick-start.html">Quick Start: Deploy Your First Mailu Instance</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">How-To Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Setup Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup-postgresql.html">Setup PostgreSQL Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup-redis.html">Setup Redis</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure-construct.html">Configure Constructs</a></li>
<li class="toctree-l2"><a class="reference internal" href="scale-resources.html">Scale Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="customize-storage.html">Customize Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="enable-optional-components.html">Enable Optional Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure-tls.html">Configure TLS Termination</a></li>
<li class="toctree-l2"><a class="reference internal" href="manage-secrets.html">Manage Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade-mailu.html">Upgrade Mailu Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup-restore.html">Backup and Restore</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration-options.html">Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/component-specifications.html">Component Specifications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/index.html">Explanation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanation/architecture.html">Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/authentication-flows.html">Authentication Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/nginx-configuration-patches.html">Nginx Configuration Patches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/storage-architecture.html">Storage Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/dovecot-submission.html">Dovecot Submission Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/egress-gateway-considerations.html">Egress Gateway Considerations for Mail Delivery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/cdk8s-patterns.html">CDK8S Patterns</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#problem">Problem</a></li>
<li><a class="reference internal" href="#prerequisites-checklist">Prerequisites Checklist</a><ul>
<li><a class="reference internal" href="#required-infrastructure">Required Infrastructure</a></li>
<li><a class="reference internal" href="#required-services">Required Services</a></li>
<li><a class="reference internal" href="#required-configuration">Required Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quick-start-path">Quick Start Path</a><ul>
<li><a class="reference internal" href="#verify-cluster-readiness">1. Verify Cluster Readiness</a></li>
<li><a class="reference internal" href="#setup-postgresql">2. Setup PostgreSQL</a></li>
<li><a class="reference internal" href="#setup-redis">3. Setup Redis</a></li>
<li><a class="reference internal" href="#setup-ingress-traefik">4. Setup Ingress (Traefik)</a></li>
<li><a class="reference internal" href="#install-cert-manager-tls-certificates">5. Install cert-manager (TLS Certificates)</a></li>
<li><a class="reference internal" href="#configure-dns">6. Configure DNS</a></li>
<li><a class="reference internal" href="#create-kubernetes-secrets">7. Create Kubernetes Secrets</a></li>
<li><a class="reference internal" href="#deploy-mailu">8. Deploy Mailu</a></li>
<li><a class="reference internal" href="#create-traefik-ingressroutes">9. Create Traefik IngressRoutes</a></li>
<li><a class="reference internal" href="#verify-deployment">10. Verify Deployment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#architecture-overview">Architecture Overview</a></li>
<li><a class="reference internal" href="#resource-planning">Resource Planning</a><ul>
<li><a class="reference internal" href="#minimum-cluster-requirements">Minimum Cluster Requirements</a></li>
<li><a class="reference internal" href="#storage-breakdown">Storage Breakdown</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting-prerequisites">Troubleshooting Prerequisites</a><ul>
<li><a class="reference internal" href="#cannot-pull-images">Cannot pull images</a></li>
<li><a class="reference internal" href="#storage-class-not-found">Storage class not found</a></li>
<li><a class="reference internal" href="#ingress-controller-not-exposing-ports">Ingress controller not exposing ports</a></li>
<li><a class="reference internal" href="#database-connection-timeout">Database connection timeout</a></li>
<li><a class="reference internal" href="#redis-connection-refused">Redis connection refused</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-checklist">Security Checklist</a></li>
<li><a class="reference internal" href="#next-steps">Next Steps</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">cdk8s-mailu</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">How-To Guides</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Setup Prerequisites</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue dark-code" role="main">
          <section id="setup-prerequisites">
<h1>Setup Prerequisites<a class="headerlink" href="#setup-prerequisites" title="Link to this heading">Â¶</a></h1>
<p><strong>Complete guide for preparing your Kubernetes cluster before deploying Mailu.</strong></p>
<section id="problem">
<h2>Problem<a class="headerlink" href="#problem" title="Link to this heading">Â¶</a></h2>
<p>Mailu requires several external services and infrastructure components to function. You need to install these prerequisites before deploying Mailu.</p>
</section>
<section id="prerequisites-checklist">
<h2>Prerequisites Checklist<a class="headerlink" href="#prerequisites-checklist" title="Link to this heading">Â¶</a></h2>
<p>Before deploying Mailu, ensure you have:</p>
<section id="required-infrastructure">
<h3>Required Infrastructure<a class="headerlink" href="#required-infrastructure" title="Link to this heading">Â¶</a></h3>
<ul class="simple">
<li><p>[ ] <strong>Kubernetes cluster</strong> (1.28+ recommended)</p>
<ul>
<li><p>Minimum 3 worker nodes for HA</p></li>
<li><p>8GB RAM, 4 CPU cores minimum</p></li>
<li><p>Internet connectivity for image pulls</p></li>
</ul>
</li>
<li><p>[ ] <strong>Persistent storage</strong> (ReadWriteOnce volumes)</p>
<ul>
<li><p>Longhorn, local-path, cloud provider storage class</p></li>
<li><p>100Gi+ available for mailboxes</p></li>
</ul>
</li>
<li><p>[ ] <strong>Ingress controller</strong> (Traefik recommended)</p>
<ul>
<li><p>Ports 80, 443, 25, 587, 465, 993, 995 exposed</p></li>
<li><p>TLS certificate management (cert-manager)</p></li>
</ul>
</li>
</ul>
</section>
<section id="required-services">
<h3>Required Services<a class="headerlink" href="#required-services" title="Link to this heading">Â¶</a></h3>
<ul class="simple">
<li><p>[ ] <strong>PostgreSQL database</strong> (12+)</p>
<ul>
<li><p>Bitnami Helm chart (simple) or CloudNativePG (production)</p></li>
<li><p>See: <a class="reference internal" href="setup-postgresql.html"><span class="std std-doc">Setup PostgreSQL</span></a></p></li>
</ul>
</li>
<li><p>[ ] <strong>Redis cache</strong> (6+)</p>
<ul>
<li><p>Bitnami Helm chart</p></li>
<li><p>See: <a class="reference internal" href="setup-redis.html"><span class="std std-doc">Setup Redis</span></a></p></li>
</ul>
</li>
</ul>
</section>
<section id="required-configuration">
<h3>Required Configuration<a class="headerlink" href="#required-configuration" title="Link to this heading">Â¶</a></h3>
<ul class="simple">
<li><p>[ ] <strong>DNS records</strong> pointing to cluster ingress</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mail.example.com</span></code> â†’ Cluster ingress IP</p></li>
<li><p>MX record for mail domain</p></li>
</ul>
</li>
<li><p>[ ] <strong>Kubernetes secrets</strong> for Mailu</p>
<ul>
<li><p>Mailu secret key</p></li>
<li><p>Database credentials</p></li>
<li><p>Initial admin password</p></li>
<li><p>See: <a class="reference internal" href="manage-secrets.html"><span class="std std-doc">Manage Secrets</span></a></p></li>
</ul>
</li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="quick-start-path">
<h2>Quick Start Path<a class="headerlink" href="#quick-start-path" title="Link to this heading">Â¶</a></h2>
<p>Follow these steps in order for a complete deployment:</p>
<section id="verify-cluster-readiness">
<h3>1. Verify Cluster Readiness<a class="headerlink" href="#verify-cluster-readiness" title="Link to this heading">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check Kubernetes version</span>
</span><span data-line="2">kubectl<span class="w"> </span>version
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Check available storage classes</span>
</span><span data-line="5">kubectl<span class="w"> </span>get<span class="w"> </span>storageclass
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Check available resources</span>
</span><span data-line="8">kubectl<span class="w"> </span>top<span class="w"> </span>nodes
</span></pre></div>
</div>
</section>
<section id="setup-postgresql">
<h3>2. Setup PostgreSQL<a class="headerlink" href="#setup-postgresql" title="Link to this heading">Â¶</a></h3>
<p>Choose deployment method based on your needs:</p>
<p><strong>Development/Testing</strong> â†’ Bitnami PostgreSQL (5 minutes):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bitnami<span class="w"> </span>https://charts.bitnami.com/bitnami
</span><span data-line="2">helm<span class="w"> </span>install<span class="w"> </span>postgres<span class="w"> </span>bitnami/postgresql<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>--namespace<span class="w"> </span>postgres<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">  </span>--set<span class="w"> </span>auth.database<span class="o">=</span>mailu<span class="w"> </span><span class="se">\</span>
</span><span data-line="5"><span class="w">  </span>--set<span class="w"> </span>auth.username<span class="o">=</span>mailu<span class="w"> </span><span class="se">\</span>
</span><span data-line="6"><span class="w">  </span>--set<span class="w"> </span>auth.password<span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">32</span><span class="k">)</span><span class="s2">&quot;</span>
</span></pre></div>
</div>
<p><strong>Production</strong> â†’ CloudNativePG (10 minutes):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Install operator</span>
</span><span data-line="2">helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>cnpg<span class="w"> </span>https://cloudnative-pg.github.io/charts
</span><span data-line="3">helm<span class="w"> </span>install<span class="w"> </span>cnpg<span class="w"> </span>cnpg/cloudnative-pg<span class="w"> </span>--namespace<span class="w"> </span>cnpg-system<span class="w"> </span>--create-namespace
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Deploy cluster (see setup-postgresql.md for full config)</span>
</span><span data-line="6">kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>postgres-cluster.yaml
</span></pre></div>
</div>
<p>ðŸ“– <strong>Detailed guide</strong>: <a class="reference internal" href="setup-postgresql.html"><span class="std std-doc">Setup PostgreSQL</span></a></p>
</section>
<section id="setup-redis">
<h3>3. Setup Redis<a class="headerlink" href="#setup-redis" title="Link to this heading">Â¶</a></h3>
<p>Simple standalone Redis (3 minutes):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">helm<span class="w"> </span>install<span class="w"> </span>redis<span class="w"> </span>bitnami/redis<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>--namespace<span class="w"> </span>redis<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>--set<span class="w"> </span>auth.enabled<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">  </span>--set<span class="w"> </span>master.persistence.size<span class="o">=</span>5Gi
</span></pre></div>
</div>
<p>ðŸ“– <strong>Detailed guide</strong>: <a class="reference internal" href="setup-redis.html"><span class="std std-doc">Setup Redis</span></a></p>
</section>
<section id="setup-ingress-traefik">
<h3>4. Setup Ingress (Traefik)<a class="headerlink" href="#setup-ingress-traefik" title="Link to this heading">Â¶</a></h3>
<p>If not already installed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Install Traefik</span>
</span><span data-line="2">helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>traefik<span class="w"> </span>https://traefik.github.io/charts
</span><span data-line="3">helm<span class="w"> </span>install<span class="w"> </span>traefik<span class="w"> </span>traefik/traefik<span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">  </span>--namespace<span class="w"> </span>traefik<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span data-line="5"><span class="w">  </span>--set<span class="w"> </span>ports.web.exposedPort<span class="o">=</span><span class="m">80</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="6"><span class="w">  </span>--set<span class="w"> </span>ports.websecure.exposedPort<span class="o">=</span><span class="m">443</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="7"><span class="w">  </span>--set<span class="w"> </span>ports.smtp.port<span class="o">=</span><span class="m">25</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="8"><span class="w">  </span>--set<span class="w"> </span>ports.smtp.exposedPort<span class="o">=</span><span class="m">25</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="9"><span class="w">  </span>--set<span class="w"> </span>ports.smtps.port<span class="o">=</span><span class="m">465</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="10"><span class="w">  </span>--set<span class="w"> </span>ports.smtps.exposedPort<span class="o">=</span><span class="m">465</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="11"><span class="w">  </span>--set<span class="w"> </span>ports.submission.port<span class="o">=</span><span class="m">587</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="12"><span class="w">  </span>--set<span class="w"> </span>ports.submission.exposedPort<span class="o">=</span><span class="m">587</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="13"><span class="w">  </span>--set<span class="w"> </span>ports.imaps.port<span class="o">=</span><span class="m">993</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="14"><span class="w">  </span>--set<span class="w"> </span>ports.imaps.exposedPort<span class="o">=</span><span class="m">993</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="15"><span class="w">  </span>--set<span class="w"> </span>ports.pop3s.port<span class="o">=</span><span class="m">995</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="16"><span class="w">  </span>--set<span class="w"> </span>ports.pop3s.exposedPort<span class="o">=</span><span class="m">995</span>
</span></pre></div>
</div>
<p>For Traefik with mail ports, create <code class="docutils literal notranslate"><span class="pre">traefik-values.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nt">ports</span><span class="p">:</span>
</span><span data-line="2"><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span data-line="3"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span data-line="4"><span class="w">    </span><span class="nt">exposedPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span data-line="5"><span class="w">  </span><span class="nt">websecure</span><span class="p">:</span>
</span><span data-line="6"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span data-line="7"><span class="w">    </span><span class="nt">exposedPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span data-line="8"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span>
</span><span data-line="9"><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span data-line="10"><span class="w">  </span><span class="c1"># Mail protocol ports</span>
</span><span data-line="11"><span class="w">  </span><span class="nt">smtp</span><span class="p">:</span>
</span><span data-line="12"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
</span><span data-line="13"><span class="w">    </span><span class="nt">exposedPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
</span><span data-line="14"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span data-line="15"><span class="w">  </span><span class="nt">submission</span><span class="p">:</span>
</span><span data-line="16"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">587</span>
</span><span data-line="17"><span class="w">    </span><span class="nt">exposedPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">587</span>
</span><span data-line="18"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span data-line="19"><span class="w">  </span><span class="nt">smtps</span><span class="p">:</span>
</span><span data-line="20"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">465</span>
</span><span data-line="21"><span class="w">    </span><span class="nt">exposedPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">465</span>
</span><span data-line="22"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span data-line="23"><span class="w">  </span><span class="nt">imaps</span><span class="p">:</span>
</span><span data-line="24"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">993</span>
</span><span data-line="25"><span class="w">    </span><span class="nt">exposedPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">993</span>
</span><span data-line="26"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span data-line="27"><span class="w">  </span><span class="nt">pop3s</span><span class="p">:</span>
</span><span data-line="28"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">995</span>
</span><span data-line="29"><span class="w">    </span><span class="nt">exposedPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">995</span>
</span><span data-line="30"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span data-line="31">
</span><span data-line="32"><span class="nt">service</span><span class="p">:</span>
</span><span data-line="33"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span><span class="w">  </span><span class="c1"># or NodePort</span>
</span><span data-line="34">
</span><span data-line="35"><span class="nt">ingressRoute</span><span class="p">:</span>
</span><span data-line="36"><span class="w">  </span><span class="nt">dashboard</span><span class="p">:</span>
</span><span data-line="37"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Enable if you want Traefik dashboard</span>
</span></pre></div>
</div>
<p>Install with custom values:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">helm<span class="w"> </span>install<span class="w"> </span>traefik<span class="w"> </span>traefik/traefik<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>--namespace<span class="w"> </span>traefik<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>--values<span class="w"> </span>traefik-values.yaml
</span></pre></div>
</div>
<p><strong>Get Ingress IP</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>traefik<span class="w"> </span>traefik
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Note the EXTERNAL-IP for DNS configuration</span>
</span></pre></div>
</div>
</section>
<section id="install-cert-manager-tls-certificates">
<h3>5. Install cert-manager (TLS Certificates)<a class="headerlink" href="#install-cert-manager-tls-certificates" title="Link to this heading">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Install cert-manager</span>
</span><span data-line="2">helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>jetstack<span class="w"> </span>https://charts.jetstack.io
</span><span data-line="3">helm<span class="w"> </span>install<span class="w"> </span>cert-manager<span class="w"> </span>jetstack/cert-manager<span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">  </span>--namespace<span class="w"> </span>cert-manager<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span data-line="5"><span class="w">  </span>--set<span class="w"> </span><span class="nv">installCRDs</span><span class="o">=</span><span class="nb">true</span>
</span></pre></div>
</div>
<p><strong>Create Letâ€™s Encrypt issuer</strong> (<code class="docutils literal notranslate"><span class="pre">letsencrypt-prod.yaml</span></code>):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
</span><span data-line="2"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
</span><span data-line="3"><span class="nt">metadata</span><span class="p">:</span>
</span><span data-line="4"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span data-line="5"><span class="nt">spec</span><span class="p">:</span>
</span><span data-line="6"><span class="w">  </span><span class="nt">acme</span><span class="p">:</span>
</span><span data-line="7"><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://acme-v02.api.letsencrypt.org/directory</span>
</span><span data-line="8"><span class="w">    </span><span class="nt">email</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-email@example.com</span><span class="w">  </span><span class="c1"># Change this!</span>
</span><span data-line="9"><span class="w">    </span><span class="nt">privateKeySecretRef</span><span class="p">:</span>
</span><span data-line="10"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span data-line="11"><span class="w">    </span><span class="nt">solvers</span><span class="p">:</span>
</span><span data-line="12"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">http01</span><span class="p">:</span>
</span><span data-line="13"><span class="w">        </span><span class="nt">ingress</span><span class="p">:</span>
</span><span data-line="14"><span class="w">          </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik</span>
</span></pre></div>
</div>
<p>Apply:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>letsencrypt-prod.yaml
</span></pre></div>
</div>
</section>
<section id="configure-dns">
<h3>6. Configure DNS<a class="headerlink" href="#configure-dns" title="Link to this heading">Â¶</a></h3>
<p>Point your domain to the cluster ingress:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Get ingress IP</span>
</span><span data-line="2"><span class="nv">INGRESS_IP</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>traefik<span class="w"> </span>traefik<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span class="k">)</span>
</span><span data-line="3"><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Configure DNS: mail.example.com â†’ </span><span class="nv">$INGRESS_IP</span><span class="s2">&quot;</span>
</span></pre></div>
</div>
<p><strong>DNS Records to create</strong>:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Record Type</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Priority</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p>mail.example.com</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;INGRESS_IP&gt;</span></code></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>MX</p></td>
<td><p>example.com</p></td>
<td><p>mail.example.com</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>TXT</p></td>
<td><p>example.com</p></td>
<td><p>v=spf1 mx ~all</p></td>
<td><p>-</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Verify DNS</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check A record</span>
</span><span data-line="2">dig<span class="w"> </span>+short<span class="w"> </span>mail.example.com
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Check MX record</span>
</span><span data-line="5">dig<span class="w"> </span>+short<span class="w"> </span>MX<span class="w"> </span>example.com
</span></pre></div>
</div>
</section>
<section id="create-kubernetes-secrets">
<h3>7. Create Kubernetes Secrets<a class="headerlink" href="#create-kubernetes-secrets" title="Link to this heading">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Create Mailu secrets</span>
</span><span data-line="2">kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>mailu
</span><span data-line="3">
</span><span data-line="4">kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>mailu-secrets<span class="w"> </span><span class="se">\</span>
</span><span data-line="5"><span class="w">  </span>--namespace<span class="o">=</span>mailu<span class="w"> </span><span class="se">\</span>
</span><span data-line="6"><span class="w">  </span>--from-literal<span class="o">=</span>secret-key<span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">16</span><span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-c1-16<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="7"><span class="w">  </span>--from-literal<span class="o">=</span><span class="nv">password</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">32</span><span class="k">)</span><span class="s2">&quot;</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Database credentials (if using manual PostgreSQL)</span>
</span><span data-line="10">kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>postgres-credentials<span class="w"> </span><span class="se">\</span>
</span><span data-line="11"><span class="w">  </span>--namespace<span class="o">=</span>mailu<span class="w"> </span><span class="se">\</span>
</span><span data-line="12"><span class="w">  </span>--from-literal<span class="o">=</span><span class="nv">username</span><span class="o">=</span><span class="s2">&quot;mailu&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="13"><span class="w">  </span>--from-literal<span class="o">=</span><span class="nv">password</span><span class="o">=</span><span class="s2">&quot;&lt;from-postgres-setup&gt;&quot;</span>
</span></pre></div>
</div>
<p>ðŸ“– <strong>Detailed guide</strong>: <a class="reference internal" href="manage-secrets.html"><span class="std std-doc">Manage Secrets</span></a></p>
</section>
<section id="deploy-mailu">
<h3>8. Deploy Mailu<a class="headerlink" href="#deploy-mailu" title="Link to this heading">Â¶</a></h3>
<p>Create <code class="docutils literal notranslate"><span class="pre">mailu.ts</span></code>:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;cdk8s&#39;</span><span class="p">;</span>
</span><span data-line="2"><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">MailuChart</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;cdk8s-mailu&#39;</span><span class="p">;</span>
</span><span data-line="3">
</span><span data-line="4"><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">App</span><span class="p">();</span>
</span><span data-line="5">
</span><span data-line="6"><span class="ow">new</span><span class="w"> </span><span class="nx">MailuChart</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mailu&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">  </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mailu&#39;</span><span class="p">,</span>
</span><span data-line="8"><span class="w">  </span><span class="nx">domain</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;example.com&#39;</span><span class="p">,</span>
</span><span data-line="9"><span class="w">  </span><span class="nx">hostnames</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;mail.example.com&#39;</span><span class="p">],</span>
</span><span data-line="10"><span class="w">  </span><span class="nx">subnet</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10.42.0.0/16&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// Your Kubernetes pod CIDR</span>
</span><span data-line="11"><span class="w">  </span><span class="nx">timezone</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;UTC&#39;</span><span class="p">,</span>
</span><span data-line="12">
</span><span data-line="13"><span class="w">  </span><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="14"><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgresql&#39;</span><span class="p">,</span>
</span><span data-line="15"><span class="w">    </span><span class="nx">postgresql</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="16"><span class="w">      </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgres-pooler.postgres.svc.cluster.local&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// CNPG</span>
</span><span data-line="17"><span class="w">      </span><span class="c1">// or: &#39;postgres-postgresql.postgres.svc.cluster.local&#39;,  // Bitnami</span>
</span><span data-line="18"><span class="w">      </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="kt">5432</span><span class="p">,</span>
</span><span data-line="19"><span class="w">      </span><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mailu&#39;</span><span class="p">,</span>
</span><span data-line="20"><span class="w">      </span><span class="nx">secretName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgres-app&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// CNPG auto-generated</span>
</span><span data-line="21"><span class="w">      </span><span class="c1">// or secretName: &#39;postgres-credentials&#39;,  // Manual secret</span>
</span><span data-line="22"><span class="w">      </span><span class="nx">secretKeys</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="23"><span class="w">        </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;username&#39;</span><span class="p">,</span>
</span><span data-line="24"><span class="w">        </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
</span><span data-line="25"><span class="w">      </span><span class="p">},</span>
</span><span data-line="26"><span class="w">    </span><span class="p">},</span>
</span><span data-line="27"><span class="w">  </span><span class="p">},</span>
</span><span data-line="28">
</span><span data-line="29"><span class="w">  </span><span class="nx">redis</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="30"><span class="w">    </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;redis-master.redis.svc.cluster.local&#39;</span><span class="p">,</span>
</span><span data-line="31"><span class="w">    </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="kt">6379</span><span class="p">,</span>
</span><span data-line="32"><span class="w">  </span><span class="p">},</span>
</span><span data-line="33">
</span><span data-line="34"><span class="w">  </span><span class="nx">secrets</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="35"><span class="w">    </span><span class="nx">mailuSecretKey</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mailu-secrets&#39;</span><span class="p">,</span>
</span><span data-line="36"><span class="w">    </span><span class="nx">initialAdminPassword</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mailu-secrets&#39;</span><span class="p">,</span>
</span><span data-line="37"><span class="w">  </span><span class="p">},</span>
</span><span data-line="38">
</span><span data-line="39"><span class="w">  </span><span class="nx">components</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="40"><span class="w">    </span><span class="nx">webmail</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span data-line="41"><span class="w">    </span><span class="nx">clamav</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span><span class="w">  </span><span class="c1">// Disable (high resources)</span>
</span><span data-line="42"><span class="w">  </span><span class="p">},</span>
</span><span data-line="43">
</span><span data-line="44"><span class="w">  </span><span class="nx">storage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="45"><span class="w">    </span><span class="nx">storageClass</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;longhorn&#39;</span><span class="p">,</span>
</span><span data-line="46"><span class="w">    </span><span class="nx">dovecot</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;50Gi&#39;</span><span class="w"> </span><span class="p">},</span>
</span><span data-line="47"><span class="w">  </span><span class="p">},</span>
</span><span data-line="48"><span class="p">});</span>
</span><span data-line="49">
</span><span data-line="50"><span class="nx">app</span><span class="p">.</span><span class="nx">synth</span><span class="p">();</span>
</span></pre></div>
</div>
<p>Deploy:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">npm<span class="w"> </span>run<span class="w"> </span>synth
</span><span data-line="2">kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>dist/mailu.k8s.yaml
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Wait for pods to start</span>
</span><span data-line="5">kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>mailu<span class="w"> </span>-w
</span></pre></div>
</div>
</section>
<section id="create-traefik-ingressroutes">
<h3>9. Create Traefik IngressRoutes<a class="headerlink" href="#create-traefik-ingressroutes" title="Link to this heading">Â¶</a></h3>
<p>See <a class="reference internal" href="configure-tls.html"><span class="std std-doc">Configure TLS</span></a> for complete IngressRoute configuration.</p>
</section>
<section id="verify-deployment">
<h3>10. Verify Deployment<a class="headerlink" href="#verify-deployment" title="Link to this heading">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check all pods running</span>
</span><span data-line="2">kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>mailu
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Test HTTPS access</span>
</span><span data-line="5">curl<span class="w"> </span>-I<span class="w"> </span>https://mail.example.com/admin
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Login to admin UI</span>
</span><span data-line="8"><span class="c1"># https://mail.example.com/admin</span>
</span><span data-line="9"><span class="c1"># Username: admin@example.com</span>
</span><span data-line="10"><span class="c1"># Password: (from mailu-secrets)</span>
</span></pre></div>
</div>
<p>ðŸ“– <strong>Complete tutorial</strong>: <a class="reference internal" href="../tutorials/01-quick-start.html"><span class="std std-doc">Quick Start</span></a></p>
</section>
</section>
<hr class="docutils" />
<section id="architecture-overview">
<h2>Architecture Overview<a class="headerlink" href="#architecture-overview" title="Link to this heading">Â¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span data-line="2">â”‚                        Internet                              â”‚
</span><span data-line="3">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span data-line="4">                        â”‚
</span><span data-line="5">                        â†“
</span><span data-line="6">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span data-line="7">â”‚  Traefik Ingress Controller (TLS Termination)               â”‚
</span><span data-line="8">â”‚  - HTTP/HTTPS (80, 443)                                     â”‚
</span><span data-line="9">â”‚  - Mail Protocols (25, 587, 465, 993, 995)                 â”‚
</span><span data-line="10">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span data-line="11">                        â”‚
</span><span data-line="12">                        â†“
</span><span data-line="13">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span data-line="14">â”‚  Mailu Front (Nginx)                                        â”‚
</span><span data-line="15">â”‚  - Protocol routing                                         â”‚
</span><span data-line="16">â”‚  - Authentication proxy                                     â”‚
</span><span data-line="17">â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span data-line="18">      â”‚                       â”‚               â”‚
</span><span data-line="19">      â†“                       â†“               â†“
</span><span data-line="20">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span data-line="21">â”‚ Admin UI     â”‚    â”‚ Webmail      â”‚    â”‚ Mail Servicesâ”‚
</span><span data-line="22">â”‚ (Flask)      â”‚    â”‚ (Roundcube)  â”‚    â”‚ (SMTP/IMAP)  â”‚
</span><span data-line="23">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span data-line="24">       â”‚                   â”‚                   â”‚
</span><span data-line="25">       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span data-line="26">                   â”‚
</span><span data-line="27">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span data-line="28">      â”‚            â”‚            â”‚
</span><span data-line="29">      â†“            â†“            â†“
</span><span data-line="30">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span data-line="31">â”‚PostgreSQLâ”‚ â”‚  Redis   â”‚ â”‚ PVCs     â”‚
</span><span data-line="32">â”‚ (Users)  â”‚ â”‚(Sessions)â”‚ â”‚(Mailbox) â”‚
</span><span data-line="33">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="resource-planning">
<h2>Resource Planning<a class="headerlink" href="#resource-planning" title="Link to this heading">Â¶</a></h2>
<section id="minimum-cluster-requirements">
<h3>Minimum Cluster Requirements<a class="headerlink" href="#minimum-cluster-requirements" title="Link to this heading">Â¶</a></h3>
<p><strong>Development/Testing</strong>:</p>
<ul class="simple">
<li><p>1 node: 4 CPU, 8GB RAM, 50GB storage</p></li>
<li><p>Storage class: local-path</p></li>
<li><p>Database: SQLite or single-instance PostgreSQL</p></li>
<li><p>Redis: Standalone</p></li>
</ul>
<p><strong>Production (&lt; 100 users)</strong>:</p>
<ul class="simple">
<li><p>3 nodes: 4 CPU, 8GB RAM, 100GB storage each</p></li>
<li><p>Storage class: Longhorn (2 replicas)</p></li>
<li><p>Database: CloudNativePG (3 replicas)</p></li>
<li><p>Redis: Master-Replica</p></li>
</ul>
<p><strong>Production (100-500 users)</strong>:</p>
<ul class="simple">
<li><p>5 nodes: 8 CPU, 16GB RAM, 200GB storage each</p></li>
<li><p>Storage class: Longhorn (2 replicas)</p></li>
<li><p>Database: CloudNativePG with backups</p></li>
<li><p>Redis: Sentinel</p></li>
</ul>
</section>
<section id="storage-breakdown">
<h3>Storage Breakdown<a class="headerlink" href="#storage-breakdown" title="Link to this heading">Â¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Dovecot mailboxes</p></td>
<td><p>50-500Gi</p></td>
<td><p>User email storage (1-5GB per user)</p></td>
</tr>
<tr class="row-odd"><td><p>PostgreSQL</p></td>
<td><p>10-20Gi</p></td>
<td><p>User accounts, config</p></td>
</tr>
<tr class="row-even"><td><p>Redis</p></td>
<td><p>5Gi</p></td>
<td><p>Sessions, cache</p></td>
</tr>
<tr class="row-odd"><td><p>Admin data</p></td>
<td><p>5Gi</p></td>
<td><p>DKIM keys, config</p></td>
</tr>
<tr class="row-even"><td><p>Postfix queue</p></td>
<td><p>5-10Gi</p></td>
<td><p>Mail queue</p></td>
</tr>
<tr class="row-odd"><td><p>Rspamd</p></td>
<td><p>5Gi</p></td>
<td><p>Spam learning</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Total storage needed</strong>: 80Gi minimum, 550Gi+ for large deployments</p>
</section>
</section>
<hr class="docutils" />
<section id="troubleshooting-prerequisites">
<h2>Troubleshooting Prerequisites<a class="headerlink" href="#troubleshooting-prerequisites" title="Link to this heading">Â¶</a></h2>
<section id="cannot-pull-images">
<h3>Cannot pull images<a class="headerlink" href="#cannot-pull-images" title="Link to this heading">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check internet connectivity</span>
</span><span data-line="2">kubectl<span class="w"> </span>run<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--image<span class="o">=</span>nginx<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>--<span class="w"> </span>curl<span class="w"> </span>-I<span class="w"> </span>google.com
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Check image pull secrets if using private registry</span>
</span><span data-line="5">kubectl<span class="w"> </span>get<span class="w"> </span>secrets<span class="w"> </span>-n<span class="w"> </span>mailu
</span></pre></div>
</div>
</section>
<section id="storage-class-not-found">
<h3>Storage class not found<a class="headerlink" href="#storage-class-not-found" title="Link to this heading">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># List available storage classes</span>
</span><span data-line="2">kubectl<span class="w"> </span>get<span class="w"> </span>storageclass
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># If none exist, install storage provider</span>
</span><span data-line="5"><span class="c1"># Longhorn example:</span>
</span><span data-line="6">kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/longhorn/longhorn/master/deploy/longhorn.yaml
</span></pre></div>
</div>
</section>
<section id="ingress-controller-not-exposing-ports">
<h3>Ingress controller not exposing ports<a class="headerlink" href="#ingress-controller-not-exposing-ports" title="Link to this heading">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check Traefik service type</span>
</span><span data-line="2">kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>traefik
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Should show type: LoadBalancer with EXTERNAL-IP</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># If pending, check cloud provider load balancer support</span>
</span><span data-line="7"><span class="c1"># Or use NodePort:</span>
</span><span data-line="8">kubectl<span class="w"> </span>patch<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>traefik<span class="w"> </span>traefik<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;{&quot;spec&quot;:{&quot;type&quot;:&quot;NodePort&quot;}}&#39;</span>
</span></pre></div>
</div>
</section>
<section id="database-connection-timeout">
<h3>Database connection timeout<a class="headerlink" href="#database-connection-timeout" title="Link to this heading">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Test connectivity from Mailu namespace</span>
</span><span data-line="2">kubectl<span class="w"> </span>run<span class="w"> </span>-n<span class="w"> </span>mailu<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--image<span class="o">=</span>postgres:15<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>psql<span class="w"> </span>-h<span class="w"> </span>postgres-postgresql.postgres.svc.cluster.local<span class="w"> </span>-U<span class="w"> </span>mailu<span class="w"> </span>-d<span class="w"> </span>mailu
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Check PostgreSQL service</span>
</span><span data-line="6">kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>postgres
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Check PostgreSQL pods</span>
</span><span data-line="9">kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>postgres
</span></pre></div>
</div>
</section>
<section id="redis-connection-refused">
<h3>Redis connection refused<a class="headerlink" href="#redis-connection-refused" title="Link to this heading">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Test connectivity</span>
</span><span data-line="2">kubectl<span class="w"> </span>run<span class="w"> </span>-n<span class="w"> </span>mailu<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--image<span class="o">=</span>redis:7<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>redis-cli<span class="w"> </span>-h<span class="w"> </span>redis-master.redis.svc.cluster.local<span class="w"> </span>ping
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Check Redis service</span>
</span><span data-line="6">kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>redis
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Check Redis pods</span>
</span><span data-line="9">kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>redis
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="security-checklist">
<h2>Security Checklist<a class="headerlink" href="#security-checklist" title="Link to this heading">Â¶</a></h2>
<p>Before deploying to production:</p>
<ul class="simple">
<li><p>[ ] <strong>Change all default passwords</strong></p>
<ul>
<li><p>PostgreSQL admin and mailu user</p></li>
<li><p>Redis password (if enabled)</p></li>
<li><p>Mailu admin password</p></li>
</ul>
</li>
<li><p>[ ] <strong>Enable TLS everywhere</strong></p>
<ul>
<li><p>Traefik TLS termination</p></li>
<li><p>Letâ€™s Encrypt certificates</p></li>
<li><p>HTTPS-only access</p></li>
</ul>
</li>
<li><p>[ ] <strong>Configure firewall rules</strong></p>
<ul>
<li><p>Restrict Kubernetes API access</p></li>
<li><p>Allow only required mail ports</p></li>
<li><p>Block direct PostgreSQL/Redis access from internet</p></li>
</ul>
</li>
<li><p>[ ] <strong>Enable network policies</strong> (optional)</p>
<ul>
<li><p>Restrict pod-to-pod communication</p></li>
<li><p>Allow only required service access</p></li>
</ul>
</li>
<li><p>[ ] <strong>Configure backups</strong></p>
<ul>
<li><p>PostgreSQL backups to S3</p></li>
<li><p>PVC snapshots (Longhorn/Velero)</p></li>
<li><p>Test restore procedures</p></li>
</ul>
</li>
<li><p>[ ] <strong>Enable monitoring</strong></p>
<ul>
<li><p>Prometheus metrics</p></li>
<li><p>Pod resource usage alerts</p></li>
<li><p>Disk space alerts</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">Â¶</a></h2>
<p>After prerequisites are ready:</p>
<ol class="arabic simple">
<li><p>ðŸ“– <strong><a class="reference internal" href="../tutorials/01-quick-start.html"><span class="std std-doc">Quick Start Tutorial</span></a></strong> - Deploy Mailu</p></li>
<li><p>ðŸ“– <strong><a class="reference internal" href="configure-tls.html"><span class="std std-doc">Configure TLS</span></a></strong> - Set up Traefik IngressRoutes</p></li>
<li><p>ðŸ“– <strong><a class="reference internal" href="manage-secrets.html"><span class="std std-doc">Manage Secrets</span></a></strong> - Create required secrets</p></li>
<li><p>ðŸ“– <strong><a class="reference internal" href="backup-restore.html"><span class="std std-doc">Backup and Restore</span></a></strong> - Protect your data</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">Â¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="setup-postgresql.html"><span class="std std-doc">Setup PostgreSQL</span></a> - Database deployment options</p></li>
<li><p><a class="reference internal" href="setup-redis.html"><span class="std std-doc">Setup Redis</span></a> - Cache deployment</p></li>
<li><p><a class="reference internal" href="configure-tls.html"><span class="std std-doc">Configure TLS</span></a> - Traefik ingress setup</p></li>
<li><p><a class="reference internal" href="../reference/component-specifications.html"><span class="std std-doc">Component Specifications</span></a> - Resource requirements</p></li>
<li><p><a class="reference internal" href="../explanation/architecture.html"><span class="std std-doc">Architecture</span></a> - Understanding the system</p></li>
</ul>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="index.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">How-To Guides</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="setup-postgresql.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Setup PostgreSQL Database</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2024-2025, Blue Dynamics Alliance</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=7026087e"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=c1cf1a6b"></script>
      <script src="../_static/logo-fix.js?v=f9d4972b"></script>
      <script src="../_static/logo-text.js"></script></body>
</html>