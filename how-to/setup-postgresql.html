<!DOCTYPE html>
<html lang="en" data-accent-color="cyan" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Setup PostgreSQL Database - cdk8s-mailu</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Setup Redis" href="setup-redis.html" /><link rel="prev" title="Setup Prerequisites" href="setup-prerequisites.html" />
      <link rel="canonical" href="https://bluedynamics.github.io/cdk8s-mailu/how-to/setup-postgresql.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"dark");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=14737038" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/brand-theme.css?v=e545c45d" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://bluedynamics.github.io/cdk8s-mailu/how-to/setup-postgresql.html"/>
  <meta property="og:title" content="Setup PostgreSQL Database"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="/">
      <img class="light-logo" src="../_static/mailu-logo.svg" alt="cdk8s-mailu" height="28" loading="lazy" />
      <img class="dark-logo" src="../_static/mailu-logo.svg" alt="cdk8s-mailu" height="28" loading="lazy" />
      <strong>cdk8s-mailu</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/01-quick-start.html">Quick Start: Deploy Your First Mailu Instance</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">How-To Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup-prerequisites.html">Setup Prerequisites</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Setup PostgreSQL Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup-redis.html">Setup Redis</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure-construct.html">Configure Constructs</a></li>
<li class="toctree-l2"><a class="reference internal" href="scale-resources.html">Scale Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="customize-storage.html">Customize Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="enable-optional-components.html">Enable Optional Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure-tls.html">Configure TLS Termination</a></li>
<li class="toctree-l2"><a class="reference internal" href="manage-secrets.html">Manage Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade-mailu.html">Upgrade Mailu Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup-restore.html">Backup and Restore</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration-options.html">Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/component-specifications.html">Component Specifications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/index.html">Explanation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanation/architecture.html">Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/authentication-flows.html">Authentication Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/nginx-configuration-patches.html">Nginx Configuration Patches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/storage-architecture.html">Storage Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/dovecot-submission.html">Dovecot Submission Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/egress-gateway-considerations.html">Egress Gateway Considerations for Mail Delivery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/cdk8s-patterns.html">CDK8S Patterns</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#problem">Problem</a></li>
<li><a class="reference internal" href="#solution-options">Solution Options</a></li>
<li><a class="reference internal" href="#option-1-bitnami-postgresql-simple">Option 1: Bitnami PostgreSQL (Simple)</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#step-1-add-bitnami-helm-repository">Step 1: Add Bitnami Helm Repository</a></li>
<li><a class="reference internal" href="#step-2-create-values-file">Step 2: Create Values File</a></li>
<li><a class="reference internal" href="#step-3-install-postgresql">Step 3: Install PostgreSQL</a></li>
<li><a class="reference internal" href="#step-4-verify-installation">Step 4: Verify Installation</a></li>
<li><a class="reference internal" href="#step-5-get-connection-details">Step 5: Get Connection Details</a></li>
<li><a class="reference internal" href="#step-6-create-kubernetes-secret-for-mailu">Step 6: Create Kubernetes Secret for Mailu</a></li>
<li><a class="reference internal" href="#configure-mailu-to-use-this-database">Configure Mailu to Use This Database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#option-2-cloudnativepg-production">Option 2: CloudNativePG (Production)</a><ul>
<li><a class="reference internal" href="#id1">Prerequisites</a></li>
<li><a class="reference internal" href="#step-1-install-cloudnativepg-operator">Step 1: Install CloudNativePG Operator</a></li>
<li><a class="reference internal" href="#step-2-create-postgresql-cluster">Step 2: Create PostgreSQL Cluster</a></li>
<li><a class="reference internal" href="#step-3-create-connection-pooler-recommended">Step 3: Create Connection Pooler (Recommended)</a></li>
<li><a class="reference internal" href="#step-4-deploy-postgresql">Step 4: Deploy PostgreSQL</a></li>
<li><a class="reference internal" href="#step-5-verify-installation">Step 5: Verify Installation</a></li>
<li><a class="reference internal" href="#step-6-get-connection-details">Step 6: Get Connection Details</a></li>
<li><a class="reference internal" href="#configure-mailu-to-use-cnpg">Configure Mailu to Use CNPG</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-automatic-backups-cnpg-only">Configure Automatic Backups (CNPG Only)</a><ul>
<li><a class="reference internal" href="#prerequisites-for-s3-backups">Prerequisites for S3 Backups</a></li>
<li><a class="reference internal" href="#enable-scheduled-backups">Enable Scheduled Backups</a></li>
</ul>
</li>
<li><a class="reference internal" href="#comparison-bitnami-vs-cnpg">Comparison: Bitnami vs CNPG</a><ul>
<li><a class="reference internal" href="#bitnami-postgresql">Bitnami PostgreSQL</a></li>
<li><a class="reference internal" href="#cloudnativepg">CloudNativePG</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#bitnami-postgresql-issues">Bitnami PostgreSQL Issues</a></li>
<li><a class="reference internal" href="#cloudnativepg-issues">CloudNativePG Issues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#monitoring-and-maintenance">Monitoring and Maintenance</a><ul>
<li><a class="reference internal" href="#check-database-size">Check Database Size</a></li>
<li><a class="reference internal" href="#check-active-connections">Check Active Connections</a></li>
<li><a class="reference internal" href="#vacuum-database-maintenance">Vacuum Database (Maintenance)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration-between-solutions">Migration Between Solutions</a><ul>
<li><a class="reference internal" href="#migrate-from-bitnami-to-cnpg">Migrate from Bitnami to CNPG</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">cdk8s-mailu</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">How-To Guides</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Setup PostgreSQL Database</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue dark-code" role="main">
          <section id="setup-postgresql-database">
<h1>Setup PostgreSQL Database<a class="headerlink" href="#setup-postgresql-database" title="Link to this heading">¶</a></h1>
<p><strong>How to deploy PostgreSQL for Mailu using either a simple Helm chart or production-grade CloudNativePG.</strong></p>
<section id="problem">
<h2>Problem<a class="headerlink" href="#problem" title="Link to this heading">¶</a></h2>
<p>Mailu requires a PostgreSQL database for storing user accounts, domains, aliases, and configuration. You need to deploy PostgreSQL before deploying Mailu.</p>
</section>
<section id="solution-options">
<h2>Solution Options<a class="headerlink" href="#solution-options" title="Link to this heading">¶</a></h2>
<p>Choose the approach that matches your needs:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Approach</p></th>
<th class="head"><p>Use Case</p></th>
<th class="head"><p>HA</p></th>
<th class="head"><p>Backups</p></th>
<th class="head"><p>Complexity</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Bitnami PostgreSQL</strong></p></td>
<td><p>Development, testing, small deployments</p></td>
<td><p>Optional</p></td>
<td><p>Manual</p></td>
<td><p>Low</p></td>
</tr>
<tr class="row-odd"><td><p><strong>CloudNativePG (CNPG)</strong></p></td>
<td><p>Production, HA required</p></td>
<td><p>Built-in</p></td>
<td><p>Automatic</p></td>
<td><p>Medium</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="option-1-bitnami-postgresql-simple">
<h2>Option 1: Bitnami PostgreSQL (Simple)<a class="headerlink" href="#option-1-bitnami-postgresql-simple" title="Link to this heading">¶</a></h2>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Helm 3 installed</p></li>
<li><p>Kubernetes cluster with persistent storage</p></li>
</ul>
</section>
<section id="step-1-add-bitnami-helm-repository">
<h3>Step 1: Add Bitnami Helm Repository<a class="headerlink" href="#step-1-add-bitnami-helm-repository" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bitnami<span class="w"> </span>https://charts.bitnami.com/bitnami
</span><span data-line="2">helm<span class="w"> </span>repo<span class="w"> </span>update
</span></pre></div>
</div>
</section>
<section id="step-2-create-values-file">
<h3>Step 2: Create Values File<a class="headerlink" href="#step-2-create-values-file" title="Link to this heading">¶</a></h3>
<p>Create <code class="docutils literal notranslate"><span class="pre">postgres-values.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Bitnami PostgreSQL configuration for Mailu</span>
</span><span data-line="2">
</span><span data-line="3"><span class="nt">auth</span><span class="p">:</span>
</span><span data-line="4"><span class="w">  </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mailu</span>
</span><span data-line="5"><span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mailu</span>
</span><span data-line="6"><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CHANGE_ME_SECURE_PASSWORD&quot;</span><span class="w">  </span><span class="c1"># Change this!</span>
</span><span data-line="7"><span class="w">  </span><span class="nt">postgresPassword</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CHANGE_ME_ADMIN_PASSWORD&quot;</span><span class="w">  </span><span class="c1"># Change this!</span>
</span><span data-line="8">
</span><span data-line="9"><span class="nt">primary</span><span class="p">:</span>
</span><span data-line="10"><span class="w">  </span><span class="nt">persistence</span><span class="p">:</span>
</span><span data-line="11"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span data-line="12"><span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
</span><span data-line="13"><span class="w">    </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">longhorn</span><span class="w">  </span><span class="c1"># Your storage class</span>
</span><span data-line="14">
</span><span data-line="15"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span data-line="16"><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span data-line="17"><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">250m</span>
</span><span data-line="18"><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
</span><span data-line="19"><span class="w">    </span><span class="nt">limits</span><span class="p">:</span>
</span><span data-line="20"><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000m</span>
</span><span data-line="21"><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span data-line="22">
</span><span data-line="23"><span class="w">  </span><span class="c1"># Optional: Configure backups</span>
</span><span data-line="24"><span class="w">  </span><span class="c1"># initdb:</span>
</span><span data-line="25"><span class="w">  </span><span class="c1">#   scripts:</span>
</span><span data-line="26"><span class="w">  </span><span class="c1">#     setup_backup.sh: |</span>
</span><span data-line="27"><span class="w">  </span><span class="c1">#       #!/bin/bash</span>
</span><span data-line="28"><span class="w">  </span><span class="c1">#       # Backup configuration here</span>
</span><span data-line="29">
</span><span data-line="30"><span class="nt">metrics</span><span class="p">:</span>
</span><span data-line="31"><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span data-line="32"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span data-line="33"><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span data-line="34"><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50m</span>
</span><span data-line="35"><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64Mi</span>
</span></pre></div>
</div>
<p><strong>Security note</strong>: Generate secure passwords:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Generate random passwords</span>
</span><span data-line="2"><span class="nv">MAILU_DB_PASSWORD</span><span class="o">=</span><span class="k">$(</span>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">32</span><span class="k">)</span>
</span><span data-line="3"><span class="nv">POSTGRES_ADMIN_PASSWORD</span><span class="o">=</span><span class="k">$(</span>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">32</span><span class="k">)</span>
</span><span data-line="4">
</span><span data-line="5"><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mailu DB password: </span><span class="nv">$MAILU_DB_PASSWORD</span><span class="s2">&quot;</span>
</span><span data-line="6"><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;PostgreSQL admin password: </span><span class="nv">$POSTGRES_ADMIN_PASSWORD</span><span class="s2">&quot;</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Update values file with these passwords</span>
</span></pre></div>
</div>
</section>
<section id="step-3-install-postgresql">
<h3>Step 3: Install PostgreSQL<a class="headerlink" href="#step-3-install-postgresql" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Create namespace</span>
</span><span data-line="2">kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>postgres
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Install PostgreSQL</span>
</span><span data-line="5">helm<span class="w"> </span>install<span class="w"> </span>postgres<span class="w"> </span>bitnami/postgresql<span class="w"> </span><span class="se">\</span>
</span><span data-line="6"><span class="w">  </span>--namespace<span class="w"> </span>postgres<span class="w"> </span><span class="se">\</span>
</span><span data-line="7"><span class="w">  </span>--values<span class="w"> </span>postgres-values.yaml
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Wait for pod to be ready</span>
</span><span data-line="10">kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--for<span class="o">=</span><span class="nv">condition</span><span class="o">=</span>ready<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>postgresql<span class="w"> </span>--timeout<span class="o">=</span>300s
</span></pre></div>
</div>
</section>
<section id="step-4-verify-installation">
<h3>Step 4: Verify Installation<a class="headerlink" href="#step-4-verify-installation" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check pod status</span>
</span><span data-line="2">kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>postgres
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Test database connection</span>
</span><span data-line="5">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-postgresql-0<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="6"><span class="w">  </span>psql<span class="w"> </span>-U<span class="w"> </span>mailu<span class="w"> </span>-d<span class="w"> </span>mailu<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT version();&quot;</span>
</span></pre></div>
</div>
</section>
<section id="step-5-get-connection-details">
<h3>Step 5: Get Connection Details<a class="headerlink" href="#step-5-get-connection-details" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Get service name (for Mailu configuration)</span>
</span><span data-line="2">kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>postgres
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Service name will be: postgres-postgresql</span>
</span><span data-line="5"><span class="c1"># Connection string: postgres-postgresql.postgres.svc.cluster.local:5432</span>
</span></pre></div>
</div>
</section>
<section id="step-6-create-kubernetes-secret-for-mailu">
<h3>Step 6: Create Kubernetes Secret for Mailu<a class="headerlink" href="#step-6-create-kubernetes-secret-for-mailu" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Create secret with database credentials</span>
</span><span data-line="2">kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>postgres-credentials<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>--namespace<span class="o">=</span>mailu<span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">  </span>--from-literal<span class="o">=</span><span class="nv">username</span><span class="o">=</span><span class="s2">&quot;mailu&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="5"><span class="w">  </span>--from-literal<span class="o">=</span><span class="nv">password</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$MAILU_DB_PASSWORD</span><span class="s2">&quot;</span>
</span></pre></div>
</div>
</section>
<section id="configure-mailu-to-use-this-database">
<h3>Configure Mailu to Use This Database<a class="headerlink" href="#configure-mailu-to-use-this-database" title="Link to this heading">¶</a></h3>
<p>In your CDK8S <code class="docutils literal notranslate"><span class="pre">MailuChart</span></code> configuration:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgresql&#39;</span><span class="p">,</span>
</span><span data-line="3"><span class="w">  </span><span class="nx">postgresql</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgres-postgresql.postgres.svc.cluster.local&#39;</span><span class="p">,</span>
</span><span data-line="5"><span class="w">    </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="kt">5432</span><span class="p">,</span>
</span><span data-line="6"><span class="w">    </span><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mailu&#39;</span><span class="p">,</span>
</span><span data-line="7"><span class="w">    </span><span class="nx">secretName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgres-credentials&#39;</span><span class="p">,</span>
</span><span data-line="8"><span class="w">    </span><span class="nx">secretKeys</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">      </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;username&#39;</span><span class="p">,</span>
</span><span data-line="10"><span class="w">      </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
</span><span data-line="11"><span class="w">    </span><span class="p">},</span>
</span><span data-line="12"><span class="w">  </span><span class="p">},</span>
</span><span data-line="13"><span class="p">}</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="option-2-cloudnativepg-production">
<h2>Option 2: CloudNativePG (Production)<a class="headerlink" href="#option-2-cloudnativepg-production" title="Link to this heading">¶</a></h2>
<section id="id1">
<h3>Prerequisites<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>CloudNativePG operator installed</p></li>
<li><p>S3-compatible storage for backups (optional but recommended)</p></li>
<li><p>Kubernetes cluster with persistent storage</p></li>
</ul>
</section>
<section id="step-1-install-cloudnativepg-operator">
<h3>Step 1: Install CloudNativePG Operator<a class="headerlink" href="#step-1-install-cloudnativepg-operator" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Add CNPG Helm repository</span>
</span><span data-line="2">helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>cnpg<span class="w"> </span>https://cloudnative-pg.github.io/charts
</span><span data-line="3">helm<span class="w"> </span>repo<span class="w"> </span>update
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Install operator</span>
</span><span data-line="6">helm<span class="w"> </span>install<span class="w"> </span>cnpg-operator<span class="w"> </span>cnpg/cloudnative-pg<span class="w"> </span><span class="se">\</span>
</span><span data-line="7"><span class="w">  </span>--namespace<span class="w"> </span>cnpg-system<span class="w"> </span><span class="se">\</span>
</span><span data-line="8"><span class="w">  </span>--create-namespace
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Verify operator is running</span>
</span><span data-line="11">kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>cnpg-system
</span></pre></div>
</div>
</section>
<section id="step-2-create-postgresql-cluster">
<h3>Step 2: Create PostgreSQL Cluster<a class="headerlink" href="#step-2-create-postgresql-cluster" title="Link to this heading">¶</a></h3>
<p>Create <code class="docutils literal notranslate"><span class="pre">postgres-cluster.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql.cnpg.io/v1</span>
</span><span data-line="2"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span>
</span><span data-line="3"><span class="nt">metadata</span><span class="p">:</span>
</span><span data-line="4"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span data-line="5"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span data-line="6"><span class="nt">spec</span><span class="p">:</span>
</span><span data-line="7"><span class="w">  </span><span class="nt">instances</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">  </span><span class="c1"># High availability with 3 replicas</span>
</span><span data-line="8">
</span><span data-line="9"><span class="w">  </span><span class="nt">postgresql</span><span class="p">:</span>
</span><span data-line="10"><span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
</span><span data-line="11"><span class="w">      </span><span class="nt">max_connections</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;200&quot;</span>
</span><span data-line="12"><span class="w">      </span><span class="nt">shared_buffers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;256MB&quot;</span>
</span><span data-line="13"><span class="w">      </span><span class="nt">effective_cache_size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1GB&quot;</span>
</span><span data-line="14"><span class="w">      </span><span class="nt">maintenance_work_mem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;64MB&quot;</span>
</span><span data-line="15"><span class="w">      </span><span class="nt">checkpoint_completion_target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0.9&quot;</span>
</span><span data-line="16"><span class="w">      </span><span class="nt">wal_buffers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;16MB&quot;</span>
</span><span data-line="17"><span class="w">      </span><span class="nt">default_statistics_target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;100&quot;</span>
</span><span data-line="18"><span class="w">      </span><span class="nt">random_page_cost</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.1&quot;</span>
</span><span data-line="19"><span class="w">      </span><span class="nt">effective_io_concurrency</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;200&quot;</span>
</span><span data-line="20">
</span><span data-line="21"><span class="w">  </span><span class="nt">bootstrap</span><span class="p">:</span>
</span><span data-line="22"><span class="w">    </span><span class="nt">initdb</span><span class="p">:</span>
</span><span data-line="23"><span class="w">      </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mailu</span>
</span><span data-line="24"><span class="w">      </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mailu</span>
</span><span data-line="25"><span class="w">      </span><span class="nt">secret</span><span class="p">:</span>
</span><span data-line="26"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-app</span>
</span><span data-line="27">
</span><span data-line="28"><span class="w">  </span><span class="nt">storage</span><span class="p">:</span>
</span><span data-line="29"><span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
</span><span data-line="30"><span class="w">    </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">longhorn</span>
</span><span data-line="31">
</span><span data-line="32"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span data-line="33"><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span data-line="34"><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">250m</span>
</span><span data-line="35"><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
</span><span data-line="36"><span class="w">    </span><span class="nt">limits</span><span class="p">:</span>
</span><span data-line="37"><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000m</span>
</span><span data-line="38"><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span data-line="39">
</span><span data-line="40"><span class="w">  </span><span class="c1"># Monitoring</span>
</span><span data-line="41"><span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span>
</span><span data-line="42"><span class="w">    </span><span class="nt">enablePodMonitor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span data-line="43">
</span><span data-line="44"><span class="w">  </span><span class="c1"># Connection pooler (recommended)</span>
</span><span data-line="45"><span class="w">  </span><span class="nt">enableSuperuserAccess</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span data-line="46">
</span><span data-line="47"><span class="w">  </span><span class="c1"># Automatic backup to S3 (optional but recommended)</span>
</span><span data-line="48"><span class="w">  </span><span class="c1"># backup:</span>
</span><span data-line="49"><span class="w">  </span><span class="c1">#   barmanObjectStore:</span>
</span><span data-line="50"><span class="w">  </span><span class="c1">#     destinationPath: s3://backup-bucket/postgres-mailu/</span>
</span><span data-line="51"><span class="w">  </span><span class="c1">#     endpointURL: https://s3.your-region.amazonaws.com</span>
</span><span data-line="52"><span class="w">  </span><span class="c1">#     s3Credentials:</span>
</span><span data-line="53"><span class="w">  </span><span class="c1">#       accessKeyId:</span>
</span><span data-line="54"><span class="w">  </span><span class="c1">#         name: s3-credentials</span>
</span><span data-line="55"><span class="w">  </span><span class="c1">#         key: access-key-id</span>
</span><span data-line="56"><span class="w">  </span><span class="c1">#       secretAccessKey:</span>
</span><span data-line="57"><span class="w">  </span><span class="c1">#         name: s3-credentials</span>
</span><span data-line="58"><span class="w">  </span><span class="c1">#         key: secret-access-key</span>
</span><span data-line="59"><span class="w">  </span><span class="c1">#     wal:</span>
</span><span data-line="60"><span class="w">  </span><span class="c1">#       compression: gzip</span>
</span><span data-line="61"><span class="w">  </span><span class="c1">#   retentionPolicy: &quot;30d&quot;</span>
</span><span data-line="62">
</span><span data-line="63"><span class="nn">---</span>
</span><span data-line="64"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span data-line="65"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
</span><span data-line="66"><span class="nt">metadata</span><span class="p">:</span>
</span><span data-line="67"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-app</span>
</span><span data-line="68"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span data-line="69"><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/basic-auth</span>
</span><span data-line="70"><span class="nt">stringData</span><span class="p">:</span>
</span><span data-line="71"><span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mailu</span>
</span><span data-line="72"><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CHANGE_ME_SECURE_PASSWORD&quot;</span><span class="w">  </span><span class="c1"># Change this!</span>
</span></pre></div>
</div>
<p><strong>Generate secure password</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nv">MAILU_DB_PASSWORD</span><span class="o">=</span><span class="k">$(</span>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">32</span><span class="k">)</span>
</span><span data-line="2"><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mailu DB password: </span><span class="nv">$MAILU_DB_PASSWORD</span><span class="s2">&quot;</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Update password in postgres-cluster.yaml</span>
</span></pre></div>
</div>
</section>
<section id="step-3-create-connection-pooler-recommended">
<h3>Step 3: Create Connection Pooler (Recommended)<a class="headerlink" href="#step-3-create-connection-pooler-recommended" title="Link to this heading">¶</a></h3>
<p>Create <code class="docutils literal notranslate"><span class="pre">postgres-pooler.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql.cnpg.io/v1</span>
</span><span data-line="2"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pooler</span>
</span><span data-line="3"><span class="nt">metadata</span><span class="p">:</span>
</span><span data-line="4"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-pooler</span>
</span><span data-line="5"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span data-line="6"><span class="nt">spec</span><span class="p">:</span>
</span><span data-line="7"><span class="w">  </span><span class="nt">cluster</span><span class="p">:</span>
</span><span data-line="8"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span data-line="9">
</span><span data-line="10"><span class="w">  </span><span class="nt">instances</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">  </span><span class="c1"># Multiple pooler instances for HA</span>
</span><span data-line="11"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rw</span><span class="w">  </span><span class="c1"># Read-write pooler</span>
</span><span data-line="12">
</span><span data-line="13"><span class="w">  </span><span class="nt">pgbouncer</span><span class="p">:</span>
</span><span data-line="14"><span class="w">    </span><span class="nt">poolMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">session</span>
</span><span data-line="15"><span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
</span><span data-line="16"><span class="w">      </span><span class="nt">max_client_conn</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1000&quot;</span>
</span><span data-line="17"><span class="w">      </span><span class="nt">default_pool_size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;25&quot;</span>
</span><span data-line="18">
</span><span data-line="19"><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span data-line="20"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span data-line="21"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span data-line="22"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-pooler</span>
</span><span data-line="23"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span data-line="24"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span data-line="25"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pgbouncer</span>
</span><span data-line="26"><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
</span><span data-line="27"><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
</span><span data-line="28"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50m</span>
</span><span data-line="29"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64Mi</span>
</span><span data-line="30"><span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
</span><span data-line="31"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200m</span>
</span><span data-line="32"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128Mi</span>
</span></pre></div>
</div>
</section>
<section id="step-4-deploy-postgresql">
<h3>Step 4: Deploy PostgreSQL<a class="headerlink" href="#step-4-deploy-postgresql" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Create namespace</span>
</span><span data-line="2">kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>postgres
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Apply cluster configuration</span>
</span><span data-line="5">kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>postgres-cluster.yaml
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Wait for cluster to be ready (may take 2-3 minutes)</span>
</span><span data-line="8">kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--for<span class="o">=</span><span class="nv">condition</span><span class="o">=</span>Ready<span class="w"> </span>cluster<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres<span class="w"> </span>--timeout<span class="o">=</span>600s
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Apply pooler (optional but recommended)</span>
</span><span data-line="11">kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>postgres-pooler.yaml
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Verify cluster status</span>
</span><span data-line="14">kubectl<span class="w"> </span>get<span class="w"> </span>cluster<span class="w"> </span>-n<span class="w"> </span>postgres
</span><span data-line="15">kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>postgres
</span></pre></div>
</div>
</section>
<section id="step-5-verify-installation">
<h3>Step 5: Verify Installation<a class="headerlink" href="#step-5-verify-installation" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check cluster status</span>
</span><span data-line="2">kubectl<span class="w"> </span>describe<span class="w"> </span>cluster<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Test database connection (via pooler)</span>
</span><span data-line="5">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-1<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="6"><span class="w">  </span>psql<span class="w"> </span>-U<span class="w"> </span>mailu<span class="w"> </span>-d<span class="w"> </span>mailu<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT version();&quot;</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Check replication status</span>
</span><span data-line="9">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-1<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="10"><span class="w">  </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT * FROM pg_stat_replication;&quot;</span>
</span></pre></div>
</div>
</section>
<section id="step-6-get-connection-details">
<h3>Step 6: Get Connection Details<a class="headerlink" href="#step-6-get-connection-details" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># List services</span>
</span><span data-line="2">kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>postgres
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Services available:</span>
</span><span data-line="5"><span class="c1"># - postgres-rw (read-write service, direct to primary)</span>
</span><span data-line="6"><span class="c1"># - postgres-r (read-only service, load balanced across replicas)</span>
</span><span data-line="7"><span class="c1"># - postgres-pooler (connection pooler, recommended)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Use pooler for best performance and connection management</span>
</span></pre></div>
</div>
</section>
<section id="configure-mailu-to-use-cnpg">
<h3>Configure Mailu to Use CNPG<a class="headerlink" href="#configure-mailu-to-use-cnpg" title="Link to this heading">¶</a></h3>
<p>In your CDK8S <code class="docutils literal notranslate"><span class="pre">MailuChart</span></code> configuration:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgresql&#39;</span><span class="p">,</span>
</span><span data-line="3"><span class="w">  </span><span class="nx">postgresql</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgres-pooler&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// Use pooler service</span>
</span><span data-line="5"><span class="w">    </span><span class="c1">// or: host: &#39;postgres-rw&#39;,  // Direct to primary</span>
</span><span data-line="6"><span class="w">    </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="kt">5432</span><span class="p">,</span>
</span><span data-line="7"><span class="w">    </span><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mailu&#39;</span><span class="p">,</span>
</span><span data-line="8"><span class="w">    </span><span class="nx">secretName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgres-app&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// CNPG auto-generated secret</span>
</span><span data-line="9"><span class="w">    </span><span class="nx">secretKeys</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">      </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;username&#39;</span><span class="p">,</span>
</span><span data-line="11"><span class="w">      </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
</span><span data-line="12"><span class="w">    </span><span class="p">},</span>
</span><span data-line="13"><span class="w">  </span><span class="p">},</span>
</span><span data-line="14"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Note</strong>: CNPG automatically creates the <code class="docutils literal notranslate"><span class="pre">postgres-app</span></code> secret. You can reference it directly in Mailu configuration.</p>
</section>
</section>
<hr class="docutils" />
<section id="configure-automatic-backups-cnpg-only">
<h2>Configure Automatic Backups (CNPG Only)<a class="headerlink" href="#configure-automatic-backups-cnpg-only" title="Link to this heading">¶</a></h2>
<section id="prerequisites-for-s3-backups">
<h3>Prerequisites for S3 Backups<a class="headerlink" href="#prerequisites-for-s3-backups" title="Link to this heading">¶</a></h3>
<p>Create S3 credentials secret:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>s3-credentials<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>--namespace<span class="o">=</span>postgres<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>--from-literal<span class="o">=</span>access-key-id<span class="o">=</span><span class="s2">&quot;YOUR_S3_ACCESS_KEY&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">  </span>--from-literal<span class="o">=</span>secret-access-key<span class="o">=</span><span class="s2">&quot;YOUR_S3_SECRET_KEY&quot;</span>
</span></pre></div>
</div>
</section>
<section id="enable-scheduled-backups">
<h3>Enable Scheduled Backups<a class="headerlink" href="#enable-scheduled-backups" title="Link to this heading">¶</a></h3>
<p>Add to <code class="docutils literal notranslate"><span class="pre">postgres-cluster.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nt">spec</span><span class="p">:</span>
</span><span data-line="2"><span class="w">  </span><span class="c1"># ... existing spec ...</span>
</span><span data-line="3">
</span><span data-line="4"><span class="w">  </span><span class="nt">backup</span><span class="p">:</span>
</span><span data-line="5"><span class="w">    </span><span class="nt">barmanObjectStore</span><span class="p">:</span>
</span><span data-line="6"><span class="w">      </span><span class="nt">destinationPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s3://backup-bucket/postgres-mailu/</span>
</span><span data-line="7"><span class="w">      </span><span class="nt">endpointURL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://s3.your-region.amazonaws.com</span>
</span><span data-line="8"><span class="w">      </span><span class="nt">s3Credentials</span><span class="p">:</span>
</span><span data-line="9"><span class="w">        </span><span class="nt">accessKeyId</span><span class="p">:</span>
</span><span data-line="10"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s3-credentials</span>
</span><span data-line="11"><span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">access-key-id</span>
</span><span data-line="12"><span class="w">        </span><span class="nt">secretAccessKey</span><span class="p">:</span>
</span><span data-line="13"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s3-credentials</span>
</span><span data-line="14"><span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secret-access-key</span>
</span><span data-line="15"><span class="w">      </span><span class="nt">wal</span><span class="p">:</span>
</span><span data-line="16"><span class="w">        </span><span class="nt">compression</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gzip</span>
</span><span data-line="17"><span class="w">        </span><span class="nt">maxParallel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span data-line="18"><span class="w">    </span><span class="nt">retentionPolicy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30d&quot;</span>
</span><span data-line="19">
</span><span data-line="20"><span class="w">  </span><span class="c1"># Schedule daily backups at 2 AM</span>
</span><span data-line="21"><span class="w">  </span><span class="nt">scheduledBackup</span><span class="p">:</span>
</span><span data-line="22"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">daily-backup</span>
</span><span data-line="23"><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span>
</span><span data-line="24"><span class="w">    </span><span class="nt">backupOwnerReference</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">self</span>
</span></pre></div>
</div>
<p>Apply changes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>postgres-cluster.yaml
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Trigger manual backup to test</span>
</span><span data-line="4">kubectl<span class="w"> </span>cnpg<span class="w"> </span>backup<span class="w"> </span>postgres<span class="w"> </span>-n<span class="w"> </span>postgres
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="comparison-bitnami-vs-cnpg">
<h2>Comparison: Bitnami vs CNPG<a class="headerlink" href="#comparison-bitnami-vs-cnpg" title="Link to this heading">¶</a></h2>
<section id="bitnami-postgresql">
<h3>Bitnami PostgreSQL<a class="headerlink" href="#bitnami-postgresql" title="Link to this heading">¶</a></h3>
<p><strong>Pros</strong>:</p>
<ul class="simple">
<li><p>✅ Simple setup with Helm</p></li>
<li><p>✅ Familiar Helm chart configuration</p></li>
<li><p>✅ Quick deployment (&lt; 2 minutes)</p></li>
<li><p>✅ Good for development/testing</p></li>
</ul>
<p><strong>Cons</strong>:</p>
<ul class="simple">
<li><p>❌ No built-in HA (single instance by default)</p></li>
<li><p>❌ Manual backup configuration</p></li>
<li><p>❌ Limited automation</p></li>
<li><p>❌ No connection pooling</p></li>
</ul>
<p><strong>Best for</strong>: Development, testing, small deployments, learning</p>
</section>
<section id="cloudnativepg">
<h3>CloudNativePG<a class="headerlink" href="#cloudnativepg" title="Link to this heading">¶</a></h3>
<p><strong>Pros</strong>:</p>
<ul class="simple">
<li><p>✅ Native Kubernetes operator</p></li>
<li><p>✅ Built-in HA (3 replicas)</p></li>
<li><p>✅ Automatic failover</p></li>
<li><p>✅ Continuous backup to S3</p></li>
<li><p>✅ Point-in-time recovery (PITR)</p></li>
<li><p>✅ Connection pooling (PgBouncer)</p></li>
<li><p>✅ Rolling updates</p></li>
<li><p>✅ Declarative configuration</p></li>
</ul>
<p><strong>Cons</strong>:</p>
<ul class="simple">
<li><p>❌ More complex setup</p></li>
<li><p>❌ Requires operator installation</p></li>
<li><p>❌ Longer initial deployment time</p></li>
<li><p>❌ More moving parts to understand</p></li>
</ul>
<p><strong>Best for</strong>: Production, HA requirements, large deployments, critical workloads</p>
</section>
</section>
<hr class="docutils" />
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h2>
<section id="bitnami-postgresql-issues">
<h3>Bitnami PostgreSQL Issues<a class="headerlink" href="#bitnami-postgresql-issues" title="Link to this heading">¶</a></h3>
<p><strong>Pod not starting</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check pod status</span>
</span><span data-line="2">kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-postgresql-0
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Check logs</span>
</span><span data-line="5">kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-postgresql-0
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Common causes:</span>
</span><span data-line="8"><span class="c1"># - PVC not bound (storage class issue)</span>
</span><span data-line="9"><span class="c1"># - Resource limits too low</span>
</span><span data-line="10"><span class="c1"># - Init scripts failing</span>
</span></pre></div>
</div>
<p><strong>Cannot connect to database</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Verify service exists</span>
</span><span data-line="2">kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-postgresql
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Test connection from pod</span>
</span><span data-line="5">kubectl<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>debug<span class="w"> </span>--image<span class="o">=</span>postgres:15<span class="w"> </span>--restart<span class="o">=</span>Never<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="6"><span class="w">  </span>psql<span class="w"> </span>-h<span class="w"> </span>postgres-postgresql.postgres.svc.cluster.local<span class="w"> </span>-U<span class="w"> </span>mailu<span class="w"> </span>-d<span class="w"> </span>mailu
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Check password is correct</span>
</span><span data-line="9">kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-postgresql<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.password}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
</span></pre></div>
</div>
</section>
<section id="cloudnativepg-issues">
<h3>CloudNativePG Issues<a class="headerlink" href="#cloudnativepg-issues" title="Link to this heading">¶</a></h3>
<p><strong>Cluster not becoming ready</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check cluster status</span>
</span><span data-line="2">kubectl<span class="w"> </span>describe<span class="w"> </span>cluster<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Check operator logs</span>
</span><span data-line="5">kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>cnpg-system<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>cloudnative-pg
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Check pod logs</span>
</span><span data-line="8">kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-1
</span></pre></div>
</div>
<p><strong>Backup failing</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check backup status</span>
</span><span data-line="2">kubectl<span class="w"> </span>get<span class="w"> </span>backup<span class="w"> </span>-n<span class="w"> </span>postgres
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Check S3 credentials</span>
</span><span data-line="5">kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>s3-credentials<span class="w"> </span>-o<span class="w"> </span>yaml
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Test S3 connectivity</span>
</span><span data-line="8">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-1<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="9"><span class="w">  </span>barman-cloud-wal-archive<span class="w"> </span>--test<span class="w"> </span>s3://backup-bucket/postgres-mailu/
</span></pre></div>
</div>
<p><strong>Pooler connection issues</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check pooler status</span>
</span><span data-line="2">kubectl<span class="w"> </span>get<span class="w"> </span>pooler<span class="w"> </span>-n<span class="w"> </span>postgres
</span><span data-line="3">kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>postgres-pooler
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Test direct connection (bypass pooler)</span>
</span><span data-line="6">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-1<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="7"><span class="w">  </span>psql<span class="w"> </span>-U<span class="w"> </span>mailu<span class="w"> </span>-d<span class="w"> </span>mailu<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT 1;&quot;</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="monitoring-and-maintenance">
<h2>Monitoring and Maintenance<a class="headerlink" href="#monitoring-and-maintenance" title="Link to this heading">¶</a></h2>
<section id="check-database-size">
<h3>Check Database Size<a class="headerlink" href="#check-database-size" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Bitnami</span>
</span><span data-line="2">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-postgresql-0<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">  </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT pg_size_pretty(pg_database_size(&#39;mailu&#39;));&quot;</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># CNPG</span>
</span><span data-line="6">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-1<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="7"><span class="w">  </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT pg_size_pretty(pg_database_size(&#39;mailu&#39;));&quot;</span>
</span></pre></div>
</div>
</section>
<section id="check-active-connections">
<h3>Check Active Connections<a class="headerlink" href="#check-active-connections" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>&lt;pod-name&gt;<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT count(*) FROM pg_stat_activity;&quot;</span>
</span></pre></div>
</div>
</section>
<section id="vacuum-database-maintenance">
<h3>Vacuum Database (Maintenance)<a class="headerlink" href="#vacuum-database-maintenance" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>&lt;pod-name&gt;<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>mailu<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;VACUUM ANALYZE;&quot;</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="migration-between-solutions">
<h2>Migration Between Solutions<a class="headerlink" href="#migration-between-solutions" title="Link to this heading">¶</a></h2>
<section id="migrate-from-bitnami-to-cnpg">
<h3>Migrate from Bitnami to CNPG<a class="headerlink" href="#migrate-from-bitnami-to-cnpg" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Backup Bitnami database</strong>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-postgresql-0<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>pg_dump<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>mailu<span class="w"> </span>&gt;<span class="w"> </span>mailu-backup.sql
</span></pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><strong>Deploy CNPG cluster</strong> (follow Option 2 above)</p></li>
<li><p><strong>Restore to CNPG</strong>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">cat<span class="w"> </span>mailu-backup.sql<span class="w"> </span><span class="p">|</span><span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>-n<span class="w"> </span>postgres<span class="w"> </span>postgres-1<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">  </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>mailu
</span></pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p><strong>Update Mailu configuration</strong> to point to CNPG</p></li>
<li><p><strong>Test and verify</strong>, then remove Bitnami deployment</p></li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="manage-secrets.html"><span class="std std-doc">Manage Secrets</span></a> - Creating database credential secrets</p></li>
<li><p><a class="reference internal" href="setup-redis.html"><span class="std std-doc">Setup Redis</span></a> - Deploy Redis for Mailu</p></li>
<li><p><a class="reference internal" href="../tutorials/01-quick-start.html"><span class="std std-doc">Quick Start</span></a> - Deploy Mailu with database</p></li>
<li><p><a class="reference internal" href="backup-restore.html"><span class="std std-doc">Backup and Restore</span></a> - Database backup strategies</p></li>
<li><p><a class="reference external" href="https://cloudnative-pg.io/documentation/">CloudNativePG Documentation</a> - Official CNPG docs</p></li>
<li><p><a class="reference external" href="https://github.com/bitnami/charts/tree/main/bitnami/postgresql">Bitnami PostgreSQL Chart</a> - Helm chart docs</p></li>
</ul>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="setup-prerequisites.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Setup Prerequisites</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="setup-redis.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Setup Redis</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2024-2025, Blue Dynamics Alliance</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=7026087e"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=c1cf1a6b"></script>
      <script src="../_static/logo-fix.js?v=f9d4972b"></script>
      <script src="../_static/logo-text.js"></script></body>
</html>